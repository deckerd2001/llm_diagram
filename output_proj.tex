\resizebox{0.85\linewidth}{!}{%
\begin{tikzpicture}[
  >=stealth,
  auxnode/.style={draw, rectangle, fill=white, minimum height=6mm, inner sep=2pt, font=\footnotesize, align=center},
  mulnode/.style={draw, circle, fill=white, minimum size=6mm, font=\footnotesize, align=center},
  addnode/.style={draw, circle, fill=white, minimum size=6mm, font=\footnotesize, align=center},
  flow/.style={->, thick, black!85},
  flow2/.style={->, double, thick, black!85},
  dimlabel/.style={font=\tiny, inner sep=1pt, align=center}
]

% \node[font=\Large\bfseries] at (9, 4.5) {Output Projection and Loss â€” Forward Pass};

% Input from Transformer
\node (Aout) at (0, 0) [align=center] {$\mathbf{A}_{\text{out}}$\\$[B,S,D]$};

% Linear projection: Z = A_out W_lm + b_lm
\node[mulnode] (Proj) [right=2.5cm of Aout] {$\bullet$};
\node[dimlabel] (Wlm) [align=center, below=0.8cm of Proj] {$\widetilde{\mathbf{W}}_{\text{lm}}$\\$[D,V]$};

\node[addnode] (AddB) [right=2.0cm of Proj] {+};
\node[dimlabel] (blm) [align=center, below=0.8cm of AddB] {$BC_{B,S}(\widetilde{\mathbf{b}}_{\text{lm}})$\\$[V]$};

% Softmax
\node[auxnode] (Soft) [right=2.0cm of AddB] {S};

% Cross-Entropy Loss
\node[auxnode] (CE) [right=2.0cm of Soft] {CE};
\node (Ytarget) [align=center, below=1.2cm of CE] {$\mathbf{Y}_{\text{targets}}$\\$[B,S]$};

% Final Loss
\node (Loss) [align=center, right=2.0cm of CE] {\small LOSS:\\$\mathcal{L}$};

% Forward flows
\draw[flow] (Aout) -- (Proj) node[dimlabel, midway, above]{from MLP};
\draw[flow2] (Wlm) -- (Proj);
\draw[flow] (Proj) -- (AddB) node[dimlabel, midway, above]{$\mathbf{Z}_{\text{lin}}$\\$[B,S,V]$};
\draw[flow] (blm) -- (AddB);
\draw[flow] (AddB) -- (Soft) node[dimlabel, midway, above]{$\mathbf{Z}_{\text{bias}}$\\$[B,S,V]$};
\draw[flow] (Soft) -- (CE) node[dimlabel, midway, above]{$\mathbf{P}$\\(probabilities)\\$[B,S,V]$};
\draw[flow] (Ytarget) -- (CE) node[dimlabel, midway, right]{targets};
\draw[flow] (CE) -- (Loss) node[dimlabel, midway, above]{scalar};


\end{tikzpicture}%
}

