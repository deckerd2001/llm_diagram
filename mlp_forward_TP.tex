\resizebox{\linewidth}{!}{%
\begin{tikzpicture}[
    >=stealth,
    auxnode/.style={draw, rectangle, fill=white, minimum height=6mm, inner sep=2pt, font=\footnotesize, align=center},
    mulnode/.style={draw, circle, fill=white, minimum size=6mm, font=\footnotesize, align=center},
    addnode/.style={draw, circle, fill=white, minimum size=6mm, font=\footnotesize, align=center},
    allreduce/.style={draw, rectangle, fill=red!30, minimum height=6mm, inner sep=2pt, font=\footnotesize, align=center, thick, draw=red!70},
    sumnode/.style={draw, circle, fill=white, minimum size=6mm, font=\tiny, align=center},
    flow/.style={->, thick, black!85},
    flow2/.style={double, ->, thick, black!85},
    commflow/.style={<->, thick, red!70, dashed},
    dimlabel/.style={font=\tiny, inner sep=1pt, align=center}
]
    \node[font=\Large\bfseries] at (11, 2.8) {MLP Forward Pass (Node $i$)};

    \pgfmathsetmacro{\verticaloffset}{-0.5}

    \node            (MIn)   at (0,\verticaloffset) {$\mathbf{X}$};
    \node[auxnode]   (LN2)   [right=1.6cm of MIn] {LN};
    \node[mulnode]   (L1Mul) [right=2.0cm of LN2] {$\bullet$};
    \node[dimlabel]  (Wup)   [below=1.0cm of L1Mul] {$\tilde{\mathbf{W}}_{\text{up}}^{(i)}$\\$[D, D_{ff}/N_T]$\\(col-split)};
    \node[addnode]   (AddB1) [right=1.8cm of L1Mul] {+};
    \node[dimlabel]  (Bup)   [below=1.0cm of AddB1] {$\tilde{\mathbf{b}}_{\text{up}}^{(i)}$\\$[D_{ff}/N_T]$};
    \node[auxnode]   (Act)   [right=1.8cm of AddB1] {GL};
    \node[auxnode]   (Drop1) [right=1.8cm of Act] {DO};
    \node[mulnode]   (L2Mul) [right=2.0cm of Drop1] {$\bullet$};
    \node[dimlabel]  (Wdown) [below=1.0cm of L2Mul] {$\tilde{\mathbf{W}}_{\text{down}}^{(i)}$\\$[D_{ff}/N_T, D]$\\(row-split)};
    \node[allreduce] (AR)    [right=1.8cm of L2Mul] {AR};
    \node[
      align=center,
      below=2.5cm of AR,
      text width=5.2cm
    ] (AR_info) {%
      \textbf{All Reduce Comm.}:\\[2pt]
      \begin{itemize}
        \item \textbf{Naive:} $2(N_T-1) \times [B,S,D]$
        \item \textbf{Ring:} $2\frac{N_T-1}{N_T} \times [B,S,D]$
      \end{itemize}
    };
    \node[addnode]   (AddB2) [right=1.8cm of AR] {+};
    \node[dimlabel]  (Bdown) [below=1.0cm of AddB2] {$\tilde{\mathbf{b}}_{\text{down}}$\\$[D]$};
    \node[auxnode]   (Drop2) [right=1.6cm of AddB2] {DO};
    \node            (MOut)  [right=1.6cm of Drop2] {$\mathbf{Y}$};

    % All-Reduce communication arrows
    \draw[commflow] (AR.north) -- ++(0, 1.8) node[midway, right, font=\tiny]{Node $j$};
    \draw[commflow] (AR.south) -- ++(0, -2.1) node[midway, right, font=\tiny]{Node $k$};

    \draw[flow] (MIn) -- (LN2) node[dimlabel, midway, above]{\shortstack{$\mathbf{X}$\\$[B,S,D]$}};
    \draw[flow] (LN2) -- (L1Mul) node[dimlabel, midway, above]{\shortstack{$\mathbf{H}$\\$[B,S,D]$}};
    \draw[flow2] (Wup) -- (L1Mul);
    \draw[flow] (L1Mul) -- (AddB1) node[dimlabel, midway, above]{\shortstack{$\mathbf{Z}_{\text{up},i}$\\$[B,S,D_{ff}/N_T]$}};
    \draw[flow] (Bup) -- (AddB1);
    \draw[flow] (AddB1) -- (Act) node[dimlabel, midway, above]{\shortstack{$\mathbf{A}_{\text{up},i}$\\$[B,S,D_{ff}/N_T]$}};
    \draw[flow] (Act) -- (Drop1) node[dimlabel, midway, above]{\shortstack{$\mathbf{H}_{\text{inter},i}$\\$[B,S,D_{ff}/N_T]$}};
    \draw[flow] (Drop1) -- (L2Mul) node[dimlabel, midway, above]{\shortstack{$\mathbf{U}_{\text{in},i}$\\$[B,S,D_{ff}/N_T]$}};
    \draw[flow2] (Wdown) -- (L2Mul);
    \draw[flow] (L2Mul) -- (AR) node[dimlabel, midway, above]{\shortstack{$\mathbf{Z}_{\text{down},i}$\\$[B,S,D]$}};
    \draw[flow] (AR) -- (AddB2) node[dimlabel, midway, above]{\shortstack{$[B,S,D]$}};
    \draw[flow] (Bdown) -- (AddB2);
    \draw[flow] (AddB2) -- (Drop2) node[dimlabel, midway, above]{\shortstack{$\mathbf{A}_{\text{out}}$\\$[B,S,D]$}};
    \draw[flow] (Drop2) -- (MOut) node[dimlabel, midway, above]{\shortstack{$\mathbf{Y}$\\$[B,S,D]$}};

\end{tikzpicture}%
}